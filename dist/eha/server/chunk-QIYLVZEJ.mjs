import './polyfills.server.mjs';
import{a as R}from"./chunk-I7RUJON7.mjs";import{a as X,b as K,c as Z,d as ee}from"./chunk-IBJ5YEAA.mjs";import{a as I}from"./chunk-W4MXG5US.mjs";import"./chunk-GIULMYYP.mjs";import{a as J}from"./chunk-B4BET5RO.mjs";import{i as W}from"./chunk-EM75C6OI.mjs";import"./chunk-COOKNSSU.mjs";import{i as T,l as G}from"./chunk-JJTOLLRI.mjs";import"./chunk-3E4TOBEZ.mjs";import{r as Y,w as P}from"./chunk-ALSAN5KH.mjs";import{Cb as w,Gb as p,Hb as h,Lb as v,Mb as C,Na as M,Nb as b,Ob as D,Pb as m,Qb as H,Rb as z,Ta as l,Ua as a,Xb as Q,Yb as O,ba as x,dc as L,ec as $,jb as A,ka as d,la as u,nb as g,qb as B,sa as S,sb as j,tb as N,ub as E,vb as F,vc as U,wa as k,wb as s,xb as r,yb as f}from"./chunk-QYIFABBK.mjs";import{a as V,b as q}from"./chunk-VVCT4QZE.mjs";var ae=["chartContainer"],oe=(()=>{class n{constructor(e,t){this._CurrentQuestionsService=e,this._HistoryProtocolsService=t,this.actionTriggeredB=new S,this.currentQuestionArr=[],this.currentQuestionArrAppended=[],this.data=[],this.isChartRendered=!1,this.currentQuestion=null,this.isRendered=!0,this.currentChartsIdPrev=[]}ngOnInit(){this._CurrentQuestionsService.currentQuestions.subscribe({next:e=>{this.AllQuestions=e}}),this._CurrentQuestionsService.currentData.subscribe(e=>{this.currentQuestionArr=e,this.currentQuestionArr.length>0&&this.isRendered&&setTimeout(()=>{this.renderChart(),this.isRendered=!1},200)})}ngOnDestroy(){this._CurrentQuestionsService.updateData([])}startNode(){this.currentQuestionArrAppended.push(this.AllQuestions[0]),this.data.push({id:"root",name:this.currentQuestionArr[0].charts[0].title,parentId:null,collapsed:!1,isNewNode:!1}),this.currentQuestionArr[0].choices.forEach(e=>{this.data.push({id:e.next_question_id.toString(),name:e.text,parentId:"root",collapsed:!1,isNewNode:!1})})}renderChart(){this.isChartRendered||(this.startNode(),this.chart=new Z,this.isChartRendered=!0),this.chart.container(this.chartContainer.nativeElement).data(this.data).nodeWidth(e=>250).nodeHeight(e=>150).childrenMargin(e=>80).siblingsMargin(e=>80).nodeContent(e=>this.getCustomNodeHTML(e)).nodeButtonY(e=>10).onNodeClick(e=>this.onNodeClick(e)).linkYOffset(1).compact(!1).layout("top").render(),this.isChartRendered=!0}onNodeClick(e){console.log("Node clicked:",e),this.appendChildNode(e);let t=+this.currentChoiceId;this.currentChoiceId=+e.id;let o=document.querySelector(`[value="${t}"]`);o&&!o.checked&&o.click()}getCustomNodeHTML(e){return`
        <div data-attr="${e.data.id}" class="title__fonts__normal custom-node h-100 position-relative  d-flex justify-content-center align-items-center w-auto text-dark" 
        style="word-wrap: break-word;background-color:#e8f5fc;border-color:#409bd2;">
          <div>
            <label  class="node-header" style="font-weight:300;font-family: "Montserrat", sans-serif; ">${e.data.name}</label>
          </div>
        </div>
      `}appendChildNode(e){this.currentChoiceId=e.id;let t=this.currentQuestionArr.find(o=>o.id.toString()==e.id);if(console.log(e),!!this.currentQuestionArr.includes(t)){if(t&&t.choices)if(document.getElementById("copy")?.classList.add("d-none"),document.getElementById("responsive_copy")?.classList.add("d-none"),t.choices.length>0){let o=t.charts[0].id.toString();this.updateChart(o,t.charts[0].title,e.id.toString(),!0),t.choices.forEach(i=>{console.log(t.id.toString());let c=e.id;this.updateChart(i.next_question_id.toString(),i.text,o,!1)})}else t.charts.forEach((o,i)=>{let c=t.charts.length,_=Math.floor(c/2)==i+1;this.updateChart(o.id.toString(),o.title,e.id,_)}),document.getElementById("copy")?.classList.remove("d-none"),document.getElementById("responsive_copy")?.classList.remove("d-none");this.chart.expandAll(),this.collapse(e)}}updateChart(e,t,o,i){this.chart.addNode({id:e,name:t,parentId:o,collapsed:!1,isNewNode:!0}).render(),i&&this.chart.setCentered(e)}collapse(e){let t=[];this.currentQuestionArr.forEach(o=>{o.charts.forEach(i=>{t.push(i.id),this.currentChartsIdPrev.push(i.id)})}),this.currentChartsIdPrev.forEach(o=>{t.includes(o)||(this.chart.removeNode(o),this.currentChartsIdPrev=t)})}static{this.\u0275fac=function(t){return new(t||n)(a(R),a(I))}}static{this.\u0275cmp=x({type:n,selectors:[["app-protocol-questions-flow-charts"]],viewQuery:function(t,o){if(t&1&&v(ae,7),t&2){let i;C(i=b())&&(o.chartContainer=i.first)}},outputs:{actionTriggeredB:"actionTriggeredB"},standalone:!0,features:[Q],decls:2,vars:0,consts:[["chartContainer",""],[1,"chart-container","w-100"]],template:function(t,o){t&1&&f(0,"div",1,0)},styles:['.chart-container[_ngcontent-%COMP%]{width:100%;max-height:80vh;overflow-y:scroll;overflow:hidden}  .svg-chart-container{width:100%}  .custom-node{border:1px solid #ccc;border-radius:8px;box-shadow:0 4px 8px #0000001a;text-align:center;font-family:"Arial, sans-serif";fill:#e8f5fc;stroke:#409bd2;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:10px;word-wrap:break-word;height:auto;position:relative}  .custom-node .node-header{font-weight:700;font-size:14px;cursor:pointer}  .custom-node .node-header::selection,   .custom-node .node-header *::selection{background-color:transparent}  .custom-node .node-subtitle{font-size:12px;color:#555;white-space:normal}  .custom-node .node-buttons{display:flex;justify-content:center;gap:10px;margin-top:auto}  .custom-node.active{border:2px solid #4caf50;background-color:#e8f5e9}  .node-button{padding:5px 10px;border:none;background-color:#4caf50;color:#fff;font-size:14px;border-radius:5px;cursor:pointer}  .node-button:hover{background-color:#45a049}  .orgchart .node .toggle{display:none}  .orgchart .node .toggle{pointer-events:none;opacity:.5}  ul{padding-left:10px}  .highlight-node{background-color:#ff0;border:2px solid red;transition:all .3s ease}  .highlight-path{stroke:red!important;stroke-width:4px!important;transition:stroke .3s ease}  .node-button-g{display:none}  .node-button-g{position:absolute;top:0;left:0}  .form-check-input:checked{background-color:#2490eb!important;box-shadow:none}  .form-check-input{border-radius:50%!important}  .org-path{stroke:#ccc;stroke-width:2;transition:stroke .3s ease}  path.link{fill:none;stroke:#ccc;stroke-width:2;position:relative}  .custom-node{position:relative}  .custom-node:before{content:"";position:absolute;right:50px;top:50%;transform:translateY(50%);border-radius:50%;width:16px;height:16px;border:1px solid #cccs}']})}}return n})();var de=["Questions__Description"],ue=["Question"];function pe(n,y){return this.currentQuestionArr}function he(n,y){if(n&1){let e=w();s(0,"div",9)(1,"div",10)(2,"input",11),p("change",function(){let o=d(e).$implicit,i=h().$implicit,c=h(2);return c.onCheckPreviousQuestionCheck(i),c.onDisplayNextQuestionChange(o.next_question_id),c.updateChart(o.id,o.next_question_id),u(c.onChangeMoving())}),r(),s(3,"label",12),m(4),r()()()}if(n&2){let e=y.$implicit;l(2),g("id",e.id)("value",e.next_question_id)("name",e.question_id),l(),g("for",e.id),l(),H(e.text)}}function me(n,y){if(n&1&&(s(0,"div",4,1)(2,"div",5),f(3,"div",8),s(4,"form"),E(5,he,5,5,"div",9,N),r()()()),n&2){let e=y.$implicit;l(3),g("innerHTML",e.description,M),l(2),F(e.choices)}}function _e(n,y){if(n&1&&(s(0,"div",2)(1,"div",3,0)(3,"div",4,1)(5,"div",5)(6,"div",6),f(7,"i",7),m(8),L(9,"date"),r(),f(10,"div",8),r()(),E(11,me,7,1,"div",4,pe,!0),r()()),n&2){let e=h();l(8),z(" last updated ",$(9,2,e.specificProtocol.protocol.updated_at)," "),l(2),g("innerHTML",e.specificProtocol.protocol.description,M),l(),F(e.currentQuestionArr)}}var ie=(()=>{class n{constructor(e,t,o,i,c,_){this._ActivatedRoute=e,this._SpecificProtocolService=t,this._CurrentQuestionsService=o,this.cdr=i,this._HistoryProtocolsService=c,this._PLATFORM_ID=_,this.actionTriggeredA=new S,this.currentQuestionArr=[]}ngOnInit(){P(this._PLATFORM_ID)&&(this.currentUserId=+localStorage.getItem("userId"),this.SendPatient=JSON.parse(localStorage.getItem("PatientData"))),this.handleGetCurrentCategoryId(),this.getCurrentCategory()}ngOnDestroy(){this._HistoryProtocolsService.History.next(null),P(this._PLATFORM_ID)&&localStorage.removeItem("PatientData")}handleGetCurrentCategoryId(){this._ActivatedRoute.paramMap.subscribe({next:e=>{this.protocolId=e.get("id")}})}getCurrentCategory(){this._SpecificProtocolService.getSpecificProtocol(this.protocolId).subscribe({next:e=>{this.specificProtocol=e,this._CurrentQuestionsService.updateQuestions(e.protocol.questions),P(this._PLATFORM_ID)&&localStorage.setItem("sub_category_id",e.protocol.sub_category_id.toString())},error:e=>{console.log(e)}})}displayFirstQuestion(){let e=this.specificProtocol.protocol.questions[0];this.currentQuestionArr.push(e),this._CurrentQuestionsService.updateData(this.currentQuestionArr)}onDisplayNextQuestionChange(e){let t=this.specificProtocol.protocol.questions.find(o=>o.id===e);t&&this.currentQuestionArr.push(t),this._CurrentQuestionsService.updateData(this.currentQuestionArr)}addToHistory(e){let t;this.SendPatient?(console.log(this.SendPatient),t=q(V({},this.SendPatient),{protocol_id:this.protocolId,user_id:this.currentUserId.toString()}),this._HistoryProtocolsService.addToHistoryPatient(t,e.id).subscribe({next:o=>{console.log(o)},error:o=>{console.log(o)}})):(t=e,this._HistoryProtocolsService.addToHistory(t).subscribe({next:o=>{console.log(o)},error:o=>{console.log(o)}})),console.log(t)}onCheckPreviousQuestionCheck(e){let t=this.currentQuestionArr.indexOf(e);if(t!==-1){let o=this.currentQuestionArr.splice(t+1);console.log(o),o.forEach(i=>{i.choices.forEach(c=>{document.querySelectorAll(`[for="${c.id}"]`).forEach(ne=>{let re=ne.previousSibling;re.checked=!1})})}),this._CurrentQuestionsService.updateData(this.currentQuestionArr)}}updateChart(e,t){this._CurrentQuestionsService.updateData(this.currentQuestionArr),this.actionTriggeredA.emit({id:t}),this.addToHistory({user_id:this.currentUserId.toString(),id:e})}onChangeMoving(){setTimeout(()=>{this.cdr.detectChanges(),console.log(this.Question.last.nativeElement),this.Question.last.nativeElement.scrollIntoView({behavior:"smooth",block:"nearest"})},0)}static{this.\u0275fac=function(t){return new(t||n)(a(T),a(ee),a(R),a(U),a(I),a(k))}}static{this.\u0275cmp=x({type:n,selectors:[["app-protocol-questions-flow-radios"]],viewQuery:function(t,o){if(t&1&&(v(de,5),v(ue,5)),t&2){let i;C(i=b())&&(o.Questions__Description=i.first),C(i=b())&&(o.Question=i)}},outputs:{actionTriggeredA:"actionTriggeredA"},standalone:!0,features:[Q],decls:1,vars:1,consts:[["Questions__Description",""],["Question",""],["id","Questions__Container",1,"position-relative","z-1","p-2"],["id","Questions__Description"],[1,"card","mb-2"],[1,"card-body","rounded-0"],[1,"lastUpdated__text"],[1,"pi","pi-history"],[3,"innerHTML"],["id","Questions__Choices"],[1,"form-check"],["type","radio",1,"form-check-input",3,"change","id","value","name"],[1,"form-check-label",3,"for"]],template:function(t,o){t&1&&A(0,_e,13,4,"div",2),t&2&&j(0,o.specificProtocol?0:-1)},dependencies:[Y],styles:["body{overflow-y:hidden}[_nghost-%COMP%]{height:calc(100% - 56px);overflow-y:auto}.lastUpdated__text[_ngcontent-%COMP%], .lastUpdated__text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{text-align:right;font-size:14px;color:#757575;line-height:24px;margin-bottom:1rem}.card-body[_ngcontent-%COMP%]{background-color:#e8f5fc;border:2px solid #409bd2;padding:16px;position:relative}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_Animation__Card 1s forwards}@keyframes _ngcontent-%COMP%_Animation__Card{0%{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}"]})}}return n})();var ge=["componentB"],fe=["componentA"],ve=()=>({height:"90vh"}),Ce=()=>[50,50];function be(n,y){if(n&1){let e=w();s(0,"div",16)(1,"div")(2,"div",17)(3,"app-protocol-questions-flow-charts",18,2),p("actionTriggeredB",function(o){d(e);let i=h();return u(i.handleActionB(o))}),r()()()()}}function ye(n,y){if(n&1){let e=w();s(0,"div",19)(1,"div",8)(2,"div",9)(3,"app-protocol-questions-flow-radios",10,0),p("actionTriggeredA",function(o){d(e);let i=h();return u(i.handleActionA(o))}),r(),s(5,"div",11)(6,"button",12),p("click",function(){d(e);let o=D(4),i=h();return o.displayFirstQuestion(),o.onChangeMoving(),u(i.isDisabled=!0)}),m(7," Start "),r(),s(8,"button",20),p("click",function(){d(e);let o=h();return u(o.copy())}),f(9,"i",14),m(10," copy Assessment "),r(),s(11,"button",15),p("click",function(){d(e);let o=h();return u(o.showRelatedProtocols())}),m(12," Related Content "),r()()()()()}if(n&2){let e=h();l(6),g("disabled",e.isDisabled)}}var Je=(()=>{class n{constructor(e,t,o,i){this._ToastrService=e,this._ActivatedRoute=t,this._Router=o,this._PLATFORM_ID=i,this.isDisabled=!1}handleGetCurrentCategoryId(){this._ActivatedRoute.paramMap.subscribe({next:e=>{this.protocolId=e.get("id")}})}showRelatedProtocols(){if(P(this._PLATFORM_ID)){let e=localStorage.getItem("sub_category_id");this._Router.navigate([`/protocols/sub-protocols-categories/${e}`])}}handleActionB(e){this.componentB.onCheckPreviousQuestionCheck(e.Question),this.componentB.onDisplayNextQuestionChange(e.Choice),console.log("works")}handleActionA(e){this.componentA.onNodeClick(e),console.log("works")}copy(){let e=document.querySelector("#Questions__Description")?.lastElementChild;navigator.clipboard.writeText(e.innerText),this._ToastrService.success("Assessment Copied")}static{this.\u0275fac=function(t){return new(t||n)(a(J),a(T),a(G),a(k))}}static{this.\u0275cmp=x({type:n,selectors:[["app-protocol-questions-page"]],viewQuery:function(t,o){if(t&1&&(v(ge,5),v(fe,5)),t&2){let i;C(i=b())&&(o.componentB=i.first),C(i=b())&&(o.componentA=i.first)}},standalone:!0,features:[Q],decls:19,vars:6,consts:[["componentB",""],["copying",""],["componentA",""],[1,"card","d-none","d-lg-block"],["styleClass","mb-5",3,"panelSizes"],["pTemplate",""],[1,"card",2,"height","100vh","padding-top","120px"],[1,"col","flex","align-items-center","justify-content-center","h-100","d-block","d-lg-none"],[1,"h-100"],[1,"Questions__Container","bg-white","h-100","w-100","d-flex","flex-column","justify-content-end"],[3,"actionTriggeredA"],[2,"background-color","#ededed","height","56px"],["id","start",1,"btn","btn-main","m-2","rounded-0",3,"click","disabled"],["id","responsive_copy",1,"btn","btn-main","m-2","rounded-0","d-none",3,"click"],[1,"pi","pi-copy"],[1,"btn","btn-main","m-2","rounded-0",3,"click"],[1,"col","flex","align-items-center","justify-content-center"],[1,"p-2","bg-white","h-100","w-100"],[3,"actionTriggeredB"],[1,"col","flex","align-items-center","justify-content-center","h-100"],["id","copy",1,"btn","btn-main","m-2","rounded-0","d-none",3,"click"]],template:function(t,o){if(t&1){let i=w();s(0,"div",3)(1,"p-splitter",4),A(2,be,5,0,"ng-template",5)(3,ye,13,1,"ng-template",5),r()(),s(4,"div",6)(5,"div",7)(6,"div",8)(7,"div",9)(8,"app-protocol-questions-flow-radios",10,0),p("actionTriggeredA",function(_){return d(i),u(o.handleActionA(_))}),r(),s(10,"div",11)(11,"button",12),p("click",function(){d(i);let _=D(9);return _.displayFirstQuestion(),_.onChangeMoving(),u(o.isDisabled=!0)}),m(12," Start "),r(),s(13,"button",13,1),p("click",function(){return d(i),u(o.copy())}),f(15,"i",14),m(16," copy Assessment "),r(),s(17,"button",15),p("click",function(){return d(i),u(o.showRelatedProtocols())}),m(18," Related Content "),r()()()()()()}t&2&&(l(),B(O(4,ve)),g("panelSizes",O(5,Ce)),l(10),g("disabled",o.isDisabled))},dependencies:[ie,oe,K,X,W],styles:[".card[_ngcontent-%COMP%]{padding-top:80px;background-color:#ededed}  .p-splitter-gutter.ng-star-inserted{padding:5px;background-color:#ededed;background-image:url(/assets/sizeable.png);background-position:center center;background-repeat:no-repeat}  .p-splitter-gutter-handle{display:none}  #resizable{min-width:100px;min-height:100px;background-color:#ededed;position:relative}  .resizable-box{width:100%;height:150px;background-color:#ededed;resize:both;overflow:auto;border:1px solid black}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{transition:background-color .3s cubic-bezier(.4,0,.2,1);transition:color .3s cubic-bezier(.4,0,.2,1);transition-delay:0ms;transition-property:color,background-color,border;appearance:none;background-color:#007ac3;border:.0625rem solid transparent;border-radius:0;box-sizing:border-box;color:#fff;display:inline-block;font-size:.875rem;font-weight:400;line-height:1.29;padding:.625rem 1rem;-webkit-tap-highlight-color:transparent;text-align:center;touch-action:manipulation;vertical-align:middle}"]})}}return n})();export{Je as ProtocolQuestionsPageComponent};
